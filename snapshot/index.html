<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="keywords" content="Grails, AuditLog, AuditTrail">
<meta name="author" content="Robert Oschwald">
<title>Grails Audit Logging Plugin</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Grails Audit Logging Plugin</h1>
<div class="details">
<span id="author" class="author">Robert Oschwald</span><br>
<span id="revnumber">version 6.0.0-SNAPSHOT,</span>
<span id="revdate">2024-12-09</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#description">1. Description</a>
<ul class="sectlevel2">
<li><a href="#compatibility">1.1. Compatibility</a></li>
<li><a href="#gorm-compatibility">1.2. GORM Compatibility</a></li>
</ul>
</li>
<li><a href="#change-log">2. Change Log</a></li>
<li><a href="#installation">3. Installation</a>
<ul class="sectlevel2">
<li><a href="#dependencies">3.1. Dependencies</a></li>
<li><a href="#create-audit-domain-artifact">3.2. Create Audit Domain Artifact</a></li>
<li><a href="#prepare-your-domain-classes-for-auditing">3.3. Prepare your Domain classes for Auditing</a></li>
</ul>
</li>
<li><a href="#upgrading-to-5-0-x">4. Upgrading to 5.0.x</a></li>
<li><a href="#upgrading-to-4-0-x">5. Upgrading to 4.0.x</a></li>
<li><a href="#upgrading-to-3-0-x">6. Upgrading to 3.0.x</a>
<ul class="sectlevel2">
<li><a href="#domain-classes">6.1. Domain Classes</a></li>
<li><a href="#configuration-changes">6.2. Configuration Changes</a></li>
<li><a href="#transactional-behavior">6.3. Transactional Behavior</a></li>
<li><a href="#handlers-removed">6.4. Handlers Removed</a></li>
<li><a href="#actor-closure">6.5. Actor Closure</a></li>
<li><a href="#stampable-trait">6.6. Stampable Trait</a></li>
</ul>
</li>
<li><a href="#configuration">7. Configuration</a>
<ul class="sectlevel2">
<li><a href="#verbose-mode">7.1. Verbose mode</a></li>
<li><a href="#logging-of-associated-ids">7.2. Logging of Associated Ids</a></li>
<li><a href="#property-value-masking">7.3. Property Value Masking</a></li>
<li><a href="#verbose-log-truncation-length">7.4. Verbose Log Truncation Length</a></li>
<li><a href="#disable-all-auditing">7.5. Disable All Auditing</a></li>
<li><a href="#log-full-class-name">7.6. Log Full Class Name</a></li>
<li><a href="#ignoring-specific-events">7.7. Ignoring Specific Events</a></li>
<li><a href="#runtime-overrides">7.8. Runtime Overrides</a></li>
<li><a href="#example-configuration">7.9. Example Configuration</a></li>
</ul>
</li>
<li><a href="#usage">8. Usage</a>
<ul class="sectlevel2">
<li><a href="#basic">8.1. Basic</a></li>
<li><a href="#context-overrides">8.2. Context Overrides</a></li>
<li><a href="#domain-overrides">8.3. Domain Overrides</a></li>
<li><a href="#customized-auditable-trait">8.4. Customized Auditable Trait</a></li>
<li><a href="#request-resolvers">8.5. Request Resolvers</a></li>
</ul>
</li>
<li><a href="#stamping">9. Stamping</a>
<ul class="sectlevel2">
<li><a href="#stamping-configuration">9.1. Stamping Configuration</a></li>
</ul>
</li>
<li><a href="#implementation">10. Implementation</a></li>
<li><a href="#auditing-and-transactions">11. Auditing and Transactions</a>
<ul class="sectlevel2">
<li><a href="#auditlogeventlistener">11.1. AuditLogEventListener</a></li>
<li><a href="#stampeventlistener">11.2. StampEventListener</a></li>
<li><a href="#plugin-descriptor">11.3. Plugin Descriptor</a></li>
<li><a href="#auditable-trait">11.4. Auditable trait</a></li>
<li><a href="#stampable-trait-2">11.5. Stampable trait</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Other formats: <a href="audit-logging-6.0.0-SNAPSHOT.pdf">PDF</a>, <a href="audit-logging-6.0.0-SNAPSHOT.epub">EPUB</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="description"><a class="anchor" href="#description"></a>1. Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Audit Logging plugin makes it easy to add customizable audit tracking by simply having your domain classes extend the <code>Auditable</code> trait.</p>
</div>
<div class="paragraph">
<p>It also provides a convenient way to add Update and Create user stamping by extending the <code>Stampable</code> trait.</p>
</div>
<div class="sect2">
<h3 id="compatibility"><a class="anchor" href="#compatibility"></a>1.1. Compatibility</h3>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Grails Version</th>
<th class="tableblock halign-left valign-top">Audit Logging Plugin Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.0.0 and later</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.0.0 (participating in Transactions). This is the recommended version if you use Grails 4.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.0.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.0.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.3.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0.0 to 3.2.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0.0 to 2.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0.x</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5.5.3</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt; 1.2.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5.3</p></td>
</tr>
</tfoot>
</table>
</div>
<div class="sect2">
<h3 id="gorm-compatibility"><a class="anchor" href="#gorm-compatibility"></a>1.2. GORM Compatibility</h3>
<div class="paragraph">
<p>This plugin is GORM agnostic, so you can use it with the GORM implementation of your choice
(Hibernate 4 or 5, MongoDB, etc.).</p>
</div>
<div class="paragraph">
<p>Please note, that only Hibernate5 is tested during development. If an issue occurs with your ORM mapper,
please file a GitHub issue.</p>
</div>
<div class="paragraph">
<p>While the plugin can log transactions for a MongoDB DataSource, it currently does not support MongoDB as an audit logging backend.
If you use this plugin to log MongoDB transactions, you must configure a SQL DataSource for Audit Logging. See Ticket #181.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="change-log"><a class="anchor" href="#change-log"></a>2. Change Log</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>6.0.0</p>
<div class="ulist">
<ul>
<li>
<p>Updated for Grails 7</p>
</li>
</ul>
</div>
</li>
<li>
<p>5.0.0</p>
<div class="ulist">
<ul>
<li>
<p>New: Participate in current Transaction by queuing audit logs. Supports nested transactions. Plugin is currently NOT ORM agnostic and needs Hibernate due to this change (PR #212). See documentation.</p>
</li>
<li>
<p>Fix #213 nested withoutAuditLog calls</p>
</li>
<li>
<p>Fix #192 Column <em>date_created</em> cannot be null (PR #218)</p>
</li>
<li>
<p>Fix #175 javax.persistence.TransactionRequiredException: no transaction is in progress</p>
</li>
<li>
<p>Fix #173 Changes to withNewSession semantics make it useless for audit log listener</p>
</li>
</ul>
</div>
</li>
<li>
<p>4.0.2</p>
<div class="ulist">
<ul>
<li>
<p>Fix #210 Add support for non-Date dateCreated/lastUpdated types</p>
</li>
<li>
<p>Fix #203 Prevent exception if AuditRequestResolverBean is not initialized (e.g. in tests)</p>
</li>
</ul>
</div>
</li>
<li>
<p>4.0.1</p>
<div class="ulist">
<ul>
<li>
<p>Fix #189 IllegalArgumentException in validator</p>
</li>
</ul>
</div>
</li>
<li>
<p>4.0.0</p>
<div class="ulist">
<ul>
<li>
<p>Initial support for Grails 4</p>
</li>
</ul>
</div>
</li>
<li>
<p>3.0.5</p>
<div class="ulist">
<ul>
<li>
<p>Add support for getOriginalValue() using config parameter.</p>
</li>
<li>
<p>Fix #193 StackOverflow with composite ID and Auditable</p>
</li>
</ul>
</div>
</li>
<li>
<p>3.0.4</p>
<div class="ulist">
<ul>
<li>
<p>Fix #153 NPE on delete for Hibernate PersistentCollection associations</p>
</li>
<li>
<p>Fix documentation for verboseEvents</p>
</li>
</ul>
</div>
</li>
<li>
<p>3.0.3</p>
<div class="ulist">
<ul>
<li>
<p>Fix #180, Fixed checking of the pull request in the travis-build.sh</p>
</li>
<li>
<p>Fix #176, #178, #179 Mongo datastores don&#8217;t have a dataSourceName property</p>
</li>
</ul>
</div>
</li>
<li>
<p>3.0.2</p>
<div class="ulist">
<ul>
<li>
<p>Fix #174 Merge default config before application ctx is refreshed</p>
</li>
</ul>
</div>
</li>
<li>
<p>3.0.1</p>
<div class="ulist">
<ul>
<li>
<p>Fix #169 Crash if project is not using Spring-Security-Core plugin</p>
</li>
<li>
<p>Minor changes to EventLogController</p>
</li>
</ul>
</div>
</li>
<li>
<p>3.0.0</p>
<div class="ulist">
<ul>
<li>
<p>Major rewrite of plugin to be trait based</p>
</li>
<li>
<p>Removed support for handler callbacks</p>
</li>
<li>
<p>Consolidated and cleaned up configuration</p>
</li>
<li>
<p>Added AuditLogContext to allow configuration overrides at the block level</p>
</li>
</ul>
</div>
</li>
<li>
<p>2.0.6</p>
<div class="ulist">
<ul>
<li>
<p>Fix #142 Re-introduced truncateLength support (and changed config parameter from <em>TRUNCATE_LENGTH</em> to <em>truncateLength</em>)</p>
</li>
<li>
<p>Fixed verbose param default description in documentation (Thanks to Matthew Moss)</p>
</li>
<li>
<p>Fix #139 Allow whitelist of properties to be used instead of a ignore list.</p>
</li>
</ul>
</div>
</li>
<li>
<p>2.0.5</p>
<div class="ulist">
<ul>
<li>
<p>Only pass session to actorClosure if a session actually exists. (Thanks to Dennie de Lange)</p>
</li>
<li>
<p>Updated syncHibernateState to use correct name array (Thanks to Matthias Born)</p>
</li>
<li>
<p>Fix ignore list not used for insert and delete (Backport from 1.x)</p>
</li>
<li>
<p>Fix #147 Document per-datasource auditLog.disabled config key</p>
</li>
</ul>
</div>
</li>
<li>
<p>2.0.4</p>
<div class="ulist">
<ul>
<li>
<p>Added option to specify createdBy,lastUpdatedBy, dateCreated,lastUpdated fieldnames per domainclass</p>
</li>
<li>
<p>and removed blank constraint for nullable stampable properties.</p>
</li>
<li>
<p>Remove preDelete as stampable event, does not make sense to stamp a delete event. (Thanks to Dennie de Lange)</p>
</li>
<li>
<p>Constraint fixes</p>
</li>
</ul>
</div>
</li>
<li>
<p>2.0.3</p>
<div class="ulist">
<ul>
<li>
<p>Fix #129 Issue with Hibernate stamping. Stamping was ignored with dynamicUpdate = true and stamping was ignored on cascading saves. (thanks to Dennie de Lange)</p>
</li>
<li>
<p>Fix #130 Docs for verbose mode</p>
</li>
</ul>
</div>
</li>
<li>
<p>2.0.2</p>
<div class="ulist">
<ul>
<li>
<p>Fix #118, use Grails 3.0.10 internally.</p>
</li>
<li>
<p>Fix #126 Support Many-To-Many logging (thanks to Andrey Zhuchkov)</p>
</li>
</ul>
</div>
</li>
<li>
<p>2.0.1</p>
<div class="ulist">
<ul>
<li>
<p>Fix #117 Clean build. Version 2.0.0 had issues with Spring Security due to unclean build.</p>
</li>
<li>
<p>Fix #116 (partially). Replacement Patterns do work, but trailing dots are ignored for now due to Grails 3.0.x limitations.</p>
</li>
</ul>
</div>
</li>
<li>
<p>2.0.0</p>
<div class="ulist">
<ul>
<li>
<p>First Grails 3 version. Thanks to Graeme Rocher.</p>
</li>
<li>
<p>Added audit-quickstart command to create the AuditLog domain artifact</p>
</li>
<li>
<p>#96 Make identifiers available in the maps during onChange event. Thanks to dmahapatro.</p>
</li>
<li>
<p>branch: master.</p>
</li>
<li>
<p>For 1.0.x plugin version (Grails2), see 1.x_maintenance branch</p>
</li>
</ul>
</div>
</li>
<li>
<p>1.0.5</p>
<div class="ulist">
<ul>
<li>
<p>Migration of JIRA to GitHub Issues</p>
</li>
<li>
<p>Fix #92 (Support for ignoring certain Events)</p>
</li>
<li>
<p>Starting with this release, the main branch for the 1.0.x series is 1.x_maintenance. Master branch is for Grails 3.0 support, now. Both branches will be tested by Travis-CI.</p>
</li>
</ul>
</div>
</li>
<li>
<p>1.0.4</p>
<div class="ulist">
<ul>
<li>
<p>GPAUDITLOGGING-69 allow to set uri per domain object</p>
</li>
<li>
<p>GPAUDITLOGGING-62 Add identifier in handler map</p>
</li>
<li>
<p>GPAUDITLOGGING-29 support configurable id mapping for AuditLogEvent</p>
</li>
<li>
<p>GPAUDITLOGGING-70 support configurable datasource name for AuditLogEvent</p>
</li>
<li>
<p>GPAUDITLOGGING-74 Impossible to log values of zero or false</p>
</li>
<li>
<p>GPAUDITLOGGING-75 Support automatic (audit) stamping support on entities</p>
</li>
</ul>
</div>
</li>
<li>
<p>1.0.3</p>
<div class="ulist">
<ul>
<li>
<p>GPAUDITLOGGING-64 workaround for duplicate log entries written per configured dataSource</p>
</li>
<li>
<p>GPAUDITLOGGING-63 logFullClassName property</p>
</li>
</ul>
</div>
</li>
<li>
<p>1.0.2</p>
<div class="ulist">
<ul>
<li>
<p>GPAUDITLOGGING-66</p>
</li>
</ul>
</div>
</li>
<li>
<p>1.0.1</p>
<div class="ulist">
<ul>
<li>
<p>closures</p>
</li>
<li>
<p>nonVerboseDelete property</p>
</li>
<li>
<p>provide domain identifier to onSave() handler</p>
</li>
</ul>
</div>
</li>
<li>
<p>1.0.0</p>
<div class="ulist">
<ul>
<li>
<p>Grails &gt;= 2.0</p>
</li>
<li>
<p>ORM agnostic implementation</p>
</li>
<li>
<p>major cleanup and new features</p>
</li>
<li>
<p>fix #99 Plugin not working with MongoDB as Only Database</p>
</li>
<li>
<p>Changed issue management url to GH.</p>
</li>
<li>
<p>#13 Externalize AuditTrailEvent domain to user</p>
</li>
</ul>
</div>
</li>
<li>
<p>0.5.5.3</p>
<div class="ulist">
<ul>
<li>
<p>Added ability to disable audit logging by config.</p>
</li>
</ul>
</div>
</li>
<li>
<p>0.5.5.2</p>
<div class="ulist">
<ul>
<li>
<p>Added issueManagement to plugin descriptor for the portal. No changes in the plugin code.</p>
</li>
</ul>
</div>
</li>
<li>
<p>0.5.5.1</p>
<div class="ulist">
<ul>
<li>
<p>Fixed the title. No changes in the plugin code.</p>
</li>
</ul>
</div>
</li>
<li>
<p>0.5.5</p>
<div class="ulist">
<ul>
<li>
<p>collections logging</p>
</li>
<li>
<p>log ids</p>
</li>
<li>
<p>replacement patterns</p>
</li>
<li>
<p>property value masking</p>
</li>
<li>
<p>large fields support</p>
</li>
<li>
<p>fixes and enhancements</p>
</li>
</ul>
</div>
</li>
<li>
<p>0.5.4</p>
<div class="ulist">
<ul>
<li>
<p>compatibility issues with Grails 1.3.x</p>
</li>
</ul>
</div>
</li>
<li>
<p>0.5.3</p>
<div class="ulist">
<ul>
<li>
<p>GRAILSPLUGINS-2135</p>
</li>
<li>
<p>GRAILSPLUGINS-2060</p>
</li>
<li>
<p>an issue with extra JAR files that are somehow getting released as part of the plugin</p>
</li>
</ul>
</div>
</li>
<li>
<p>0.5.2</p>
<div class="ulist">
<ul>
<li>
<p>GRAILSPLUGINS-1887 and GRAILSPLUGINS-1354</p>
</li>
</ul>
</div>
</li>
<li>
<p>0.5.1</p>
<div class="ulist">
<ul>
<li>
<p>fixes regression in field logging</p>
</li>
</ul>
</div>
</li>
<li>
<p>0.5</p>
<div class="ulist">
<ul>
<li>
<p>GRAILSPLUGINS-391</p>
</li>
<li>
<p>GRAILSPLUGINS-1496</p>
</li>
<li>
<p>GRAILSPLUGINS-1181</p>
</li>
<li>
<p>GRAILSPLUGINS-1515</p>
</li>
<li>
<p>GRAILSPLUGINS-1811</p>
</li>
<li>
<p>changes to AuditLogEvent domain object uses composite id to simplify logging</p>
</li>
<li>
<p>changes to AuditLogListener uses new domain model with separate transaction</p>
</li>
<li>
<p>for logging action to avoid invalidating the main hibernate session.</p>
</li>
</ul>
</div>
</li>
<li>
<p>0.4.1</p>
<div class="ulist">
<ul>
<li>
<p>repackaged for Grails 1.1.1 see GRAILSPLUGINS-1181</p>
</li>
</ul>
</div>
</li>
<li>
<p>0.4</p>
<div class="ulist">
<ul>
<li>
<p>custom serializable implementation for AuditLogEvent so events can happen inside a webflow context.</p>
</li>
<li>
<p>tweak application.properties for loading in other grails versions</p>
</li>
<li>
<p>update to views to show URI in an event</p>
</li>
<li>
<p>fix missing oldState bug in change event</p>
</li>
</ul>
</div>
</li>
<li>
<p>0.3</p>
<div class="ulist">
<ul>
<li>
<p>actorKey and username features allow for the logging of user or userPrincipal for most security systems.</p>
</li>
<li>
<p>Fix #31 disable hotkeys for layout.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installation"><a class="anchor" href="#installation"></a>3. Installation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="dependencies"><a class="anchor" href="#dependencies"></a>3.1. Dependencies</h3>
<div class="paragraph">
<p>Add to your build.gradle project dependencies block:</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Due to the move to Maven Central, the plugin groupId has changed from org.grails.plugin to com.symentis.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
   compile <span class="string"><span class="delimiter">'</span><span class="content">com.symentis:audit-logging:{VERSION}</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then run the following to refresh gradle dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gradle">gradle classes</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
After installing the plugin, you must perform the following command to let the plugin create the audit-logging domain class and register it in application.groovy within your project.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="create-audit-domain-artifact"><a class="anchor" href="#create-audit-domain-artifact"></a>3.2. Create Audit Domain Artifact</h3>
<div class="literalblock">
<div class="content">
<pre>grails audit-quickstart &lt;your.package.name&gt; &lt;YourAuditLogEventClassName&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>grails audit-quickstart org.myaudit.example AuditTrail</pre>
</div>
</div>
<div class="paragraph">
<p>This will create the Audit Domain class and adds to application.groovy:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>grails.plugin.auditLog.auditDomainClassName = 'org.myaudit.example.AuditTrail'</pre>
</div>
</div>
<div class="paragraph">
<p>Once created, you should open the generated file to adjust the <code>mappings</code> and <code>constraints</code> to suit your needs. Next, setup additional plugin config. See</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Be sure to respect the existing nullability constraints or the plugin may not work correctly. You must update your db schema either by DDL, or using the database-migration plugin (recommended)
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since version 4.0.2 the dateCreated / lastUpdated fields can be of any type which is supported by the Grails DefaultTimestampProvider. By default, they are defined as java.util.Date in the created audit domain artifact. Both fields must be of same type.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="prepare-your-domain-classes-for-auditing"><a class="anchor" href="#prepare-your-domain-classes-for-auditing"></a>3.3. Prepare your Domain classes for Auditing</h3>
<div class="paragraph">
<p>For every Domain class you want to be audited, implement the Auditable Trait.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.plugins.orm.auditable.Auditable</span>

<span class="type">class</span> <span class="class">MyDomain</span> <span class="directive">implements</span> Auditable {
    <span class="predefined-type">String</span> whatever
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you additionally want to enable stamping, implement the Stampable Trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.plugins.orm.auditable.Auditable</span>

 <span class="type">class</span> <span class="class">MyDomain</span> <span class="directive">implements</span> Auditable, Stampable {
     <span class="predefined-type">String</span> whatever
     ...
 }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="upgrading-to-5-0-x"><a class="anchor" href="#upgrading-to-5-0-x"></a>4. Upgrading to 5.0.x</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The 5.0.0 version has some significant changes to the 4.0.x version.</p>
<div class="ulist">
<ul>
<li>
<p>The groupId of the plugin has changed from org.grails.plugin to com.symentis</p>
</li>
<li>
<p>The configuration keys are the same as in 4.0.x</p>
</li>
<li>
<p>The mechanism to audit log transaction data has changed. We now participate in transactions and queue up audit logs. The audit logs are flushed with the current transaction. If the current transaction fails, no audit logs of this transaction are committed. Due to this major change, the plugin is currently not ORM agnostic and for now depends on Hibernate. As the plugin itself does not support other GORM implementations like Mongo (see #179), this shouldn&#8217;t affect current projects.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="upgrading-to-4-0-x"><a class="anchor" href="#upgrading-to-4-0-x"></a>5. Upgrading to 4.0.x</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The 4.0.0 version of the plugin is backwards compatible with 3.0.x. Any existing configuration and customization should work out of the box.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="upgrading-to-3-0-x"><a class="anchor" href="#upgrading-to-3-0-x"></a>6. Upgrading to 3.0.x</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The 3.0.x version of the plugin is a major rewrite of the codebase. Therefore you need to upgrade your code for this version.</p>
</div>
<div class="sect2">
<h3 id="domain-classes"><a class="anchor" href="#domain-classes"></a>6.1. Domain Classes</h3>
<div class="paragraph">
<p>Prior versions of the plugin used a static property syntax to enable and customize logging:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Legacy enable/disable</span>
<span class="directive">static</span> auditable = <span class="predefined-constant">true</span>

<span class="comment">// Legacy whitelist</span>
<span class="directive">static</span> auditable = [<span class="key">auditableProperties</span>: [<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">famous</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lastUpdated</span><span class="delimiter">'</span></span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Starting with version 3.0.0, the plugin uses an <code>Auditable</code> trait and/or a <code>Stampable</code> trait as both a marker as well as a way to configure and override auditing behavior.</p>
</div>
<div class="paragraph">
<p>For the first example, just adding <code>implements Auditable</code> will enable the default behavior.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.plugins.orm.auditable.Auditable</span>
<span class="type">class</span> <span class="class">MyDomain</span> <span class="directive">implements</span> Auditable {
  ..
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the second example above, you simply override the appropriate method on the <code>Auditable</code> trait, in this case the method is <code>getLogIncluded()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Override</span>
<span class="predefined-type">Collection</span>&lt;<span class="predefined-type">String</span>&gt; getLogIncluded() {
    [<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">famous</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lastUpdated</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The getter methods on <code>Auditable</code> all follow the <code>getLog*()</code> format to minimize collisions with user methods. Typically they are <code>getLog&lt;Configuration Name&gt;()</code> followed by whatever the configurable value (included, excluded, mask) with a few exceptions.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="configuration-changes"><a class="anchor" href="#configuration-changes"></a>6.2. Configuration Changes</h3>
<div class="paragraph">
<p>To support unifying the configuration, trait, and context usage, some of the configuration properties have been renamed. The following table should help to map old values and types to the new ones:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Prior Name</th>
<th class="tableblock halign-left valign-top">New Name</th>
<th class="tableblock halign-left valign-top">New Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">auditableProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">included</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection&lt;String&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">defaultIgnore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">excluded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection&lt;String&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">excluded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection&lt;String&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">defaultMask</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mask</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection&lt;String&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nonVerboseDelete</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">verboseEvents</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection&lt;AuditEventType&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">transactional</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Removed</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inherits existing transactionality</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">actorClosure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Removed</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use AuditRequestResolver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">actorKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Removed</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use AuditRequestResolver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sessionAttribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Removed</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use AuditRequestResolver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">handlersOnly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Removed</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use Grails callback methods</p></td>
</tr>
</tbody>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stampAlways</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Removed</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use a <code>TraitInjector</code> with <code>Stampable</code></p></td>
</tr>
</tfoot>
</table>
</div>
<div class="sect2">
<h3 id="transactional-behavior"><a class="anchor" href="#transactional-behavior"></a>6.3. Transactional Behavior</h3>
<div class="paragraph">
<p>Previously, the audit logging plugin had a <code>transactional</code> flag that indicated whether to include the audit log saves in a transaction. However, the audit logging plugin should really just participate (or not) in existing transactions and not make any attempts to control transactionality at that grain. For most usage, you want your Audit domain instances to be atomically created in the same transaction as the changes that are triggering them. If there&#8217;s no existing transaction for the changes, it&#8217;s not clear why there <em>should</em> be a transaction just for the audit events or vice versa.</p>
</div>
<div class="paragraph">
<p>The Audit instances are still saved in a new session within any existing transaction.</p>
</div>
</div>
<div class="sect2">
<h3 id="handlers-removed"><a class="anchor" href="#handlers-removed"></a>6.4. Handlers Removed</h3>
<div class="paragraph">
<p>The handler callbacks such as <code>onChange</code>, <code>onSave</code>, etc. have been removed starting with version 3.0.0.</p>
</div>
<div class="paragraph">
<p>This behavior is already provided by Grails now using the <code>before*</code> and <code>after*</code> callback methods.</p>
</div>
<div class="paragraph">
<p>For example, you could do something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">beforeInsert</span>() {
    <span class="keyword">def</span> dirtyAudit = getAuditableDirtyPropertyNames()

    <span class="comment">// Do something special if certain properties are dirty, etc.</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="actor-closure"><a class="anchor" href="#actor-closure"></a>6.5. Actor Closure</h3>
<div class="paragraph">
<p>The actor closure has been replaced with a more formalized <code>AuditRequestResolver</code> strategy for resolving actor and URI information.</p>
</div>
<div class="paragraph">
<p>By default, the plugin uses the <code>DefaultAuditRequestResolver</code>, which gets Principal information from the current Grails web request context. This is essentially the same as the prior default actor closure.</p>
</div>
<div class="paragraph">
<p>If your application uses Spring Security, the plugin will register an instance of the <code>SpringSecurityRequestResolver</code> which will use the <code>springSecurityService</code> to resolve the current principal.</p>
</div>
<div class="paragraph">
<p>For other security frameworks, you can implement the <code>AuditRequestResolver</code> interface and register a bean named <code>auditRequestResolver</code> to override the resolver provided by the plugin.</p>
</div>
</div>
<div class="sect2">
<h3 id="stampable-trait"><a class="anchor" href="#stampable-trait"></a>6.6. Stampable Trait</h3>
<div class="paragraph">
<p>The <code>@Stamp</code> annotation was removed in favor of a <code>Stampable</code> trait. This keeps the usage more in line with the direction of Grails in general as well as simplifying the implementation and usage.</p>
</div>
<div class="paragraph">
<p>However, there are some limitations to implementing this as a trait:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Property names are <code>dateCreated, lastUpdated, createdBy, lastUpdatedBy</code> and are not configurable</p>
</li>
<li>
<p>If you want to customized the constraints, you must do so in your domain class</p>
</li>
<li>
<p>The values are technically populated on the <code>ValidationEvent</code> since they are non-nullable and must be populated prior to the default property validation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>stampAlways</code> has been removed. If you want to mark <strong>all</strong> of your domain objects as stampable, you could define the following <code>TraitInjector</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">StampableTraitInjector</span> <span class="directive">implements</span> TraitInjector {
    <span class="annotation">@Override</span>
    <span class="predefined-type">Class</span> getTrait() {
        Stampable
    }

    <span class="annotation">@Override</span>
    <span class="predefined-type">String</span><span class="type">[]</span> getArtefactTypes() {
        [<span class="string"><span class="delimiter">'</span><span class="content">Domain</span><span class="delimiter">'</span></span>] <span class="keyword">as</span> <span class="predefined-type">String</span><span class="type">[]</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a>7. Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The plugin configuration can be specified in the application.groovy file.
It supports Environments blocks for environment-specific configuration.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since version 2.0.0, the configuration key has changed from "auditLog" to "grails.plugins.auditLog".
If you use the old configuration key, the plugin will log a notice.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Property</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default Value</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.plugin.auditLog.auditDomainClassName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>(Required)</strong> Use <code>grails audit-quickstart</code> to create</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain Class Name for the Audit Domain class.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.plugin.auditLog.disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, audit logging is completely disabled (no listeners are registered).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.plugin.auditLog.verbose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Column by column change logging in insert and delete events (enabled by default). You can disable it if you are not interested in value changes, or if you want to set verbosity based on event type (see verboseEvents setting below)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.plugin.auditLog.verboseEvents</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[INSERT, UPDATE, DELETE]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of <code>AuditEventType</code> enums. Enables verbose logging on a per-event type basis. If <code>verbose = true</code> (default), all event types are logged verbosely, regardless of this setting.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.plugin.auditLog.ignoreEvents</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of <code>AuditEventType</code> enums that can be used to disable logging on a per-event type basis. For example, setting <code>[AuditEventType.DELETE]</code> would disable audit logging for all DELETE events only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.plugin.auditLog.failOnError</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the save of the Audit domain fails, enabling this will cause the failure to be thrown out of the listener potentially failing the entire transaction.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.plugin.auditLog.logIds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, object-ids of associated objects are logged.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.plugin.auditLog.logFullClassName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log the full entity name including the package name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.plugin.auditLog.defaultActor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'SYS'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default actor (user) to log if no user context can be found using the configured <code>AuditRequestResolver</code> implementation (see below).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.plugin.auditLog.excluded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>['version', 'lastUpdated', 'lastUpdatedBy']</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">These properties are not logged and will not trigger verbose logging when changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.plugin.auditLog.included</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code> (all persistent properties)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a global whitelist of properties to log and will override anything in the excluded list. A null value indicates that all persistent properties not in the <code>excluded</code> list specifically should be logged.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.plugin.auditLog.mask</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>['password']</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any property with this name will be masked using the <code>propertyMask</code> attribute (below).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.plugin.auditLog.propertyMask</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>**********</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String to use when masking properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.plugin.auditLog.truncateLength</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxSize</code> of <code>newValue</code>/<code>oldValue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow overriding the maximum length allowed in the <code>oldValue</code> and <code>newValue</code> fields before truncating. This property defaults to the max size allowed by the <code>constraint</code>, so it&#8217;s best to just control it that way.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.plugin.auditLog.stampEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable stamping support for entities with the <code>Stampable</code> trait (dateCreated, lastUpdated, createdBy, lastUpdatedBy).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grails.plugin.auditLog.usePersistentDirtyPropertyValues</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, the old persistent value is obtained using getPersistentValue(). On newer Grails versions, this could fail. If the original value is always NULL in your case, you can set this property to "false", so getOriginalValue() is used.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can view the above defaults in the <code>DefaultAuditLogConfig.groovy</code>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="verbose-mode"><a class="anchor" href="#verbose-mode"></a>7.1. Verbose mode</h3>
<div class="paragraph">
<p>When enabled (default), per-property logging is enabled for all operations.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>grails.plugin.auditLog.verbose = true</pre>
</div>
</div>
<div class="paragraph">
<p>or you can enable verbose logging for specific event types using:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>grails.plugin.auditLog.verboseEvents = [AuditEventType.UPDATE]</pre>
</div>
</div>
<div class="paragraph">
<p>If both verbose=true and verboseEvents are set, verbose has precedence.</p>
</div>
<div class="paragraph">
<p>If verbose=true, or verboseEvents contains AuditEventType.DELETE, deletion of an entity will cause
all properties of the deleted entity to be logged, except associations (Collections), as this is
currently not possible. See issue #153</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Verbose logging will insert 1 row of data per property of your domain object for all or verboseEvents type operations. This can result in a large amount of additional data, sometimes far more than the actual operation itself. Consider disabling verbose mode for bulk operations using the <code>AuditLogContext.withoutVerboseAuditLog { }</code> closure.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="logging-of-associated-ids"><a class="anchor" href="#logging-of-associated-ids"></a>7.2. Logging of Associated Ids</h3>
<div class="paragraph">
<p>You can log the object-ids of associated objects. Logging will be performed in the format: "[id:&lt;objId&gt;]objDetails".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.plugin.auditLog.logIds = <span class="predefined-constant">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This setting is enabled by default.</p>
</div>
</div>
<div class="sect2">
<h3 id="property-value-masking"><a class="anchor" href="#property-value-masking"></a>7.3. Property Value Masking</h3>
<div class="paragraph">
<p>You can configure properties to mask on a per-Domain-Class base. If properties are defined as masked, their values are not stored into the audit log table if verbose mode is enabled. Instead, a mask of "<strong><strong></strong><strong></strong></strong>" will be logged.</p>
</div>
<div class="paragraph">
<p>By default, "password" properties are masked. You can mask property fields in domain classes like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Override</span>
<span class="predefined-type">Collection</span>&lt;<span class="predefined-type">String</span>&gt; getLogMask() {
    [<span class="string"><span class="delimiter">'</span><span class="content">password</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">otherField</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="verbose-log-truncation-length"><a class="anchor" href="#verbose-log-truncation-length"></a>7.4. Verbose Log Truncation Length</h3>
<div class="paragraph">
<p>If you enabled verbose mode, you can configure the truncation length of detail information in the oldValue and newValue
columns (Default is 255). Configure the truncateLength in application.groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">truncateLength = <span class="integer">400</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you set truncateLength to a value &gt; 255 you must ensure that oldValue and newValue fields in your audit-log domain class are large enough. Example setting with the same maxSize constraints as the former "largeValueColumnTypes" setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> constraints = {
    <span class="comment">// For large column support (as in &lt; 1.0.6 plugin versions)</span>
    oldValue(<span class="key">nullable</span>: <span class="predefined-constant">true</span>, <span class="key">maxSize</span>: <span class="integer">65534</span>)
    newValue(<span class="key">nullable</span>: <span class="predefined-constant">true</span>, <span class="key">maxSize</span>: <span class="integer">65534</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you forget to set the constraints in your AuditLog class while setting truncateLength &gt; 255,
a truncation warning may occur and only partial information is logged.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="disable-all-auditing"><a class="anchor" href="#disable-all-auditing"></a>7.5. Disable All Auditing</h3>
<div class="paragraph">
<p>You can disable auditing by config. If you disable auditing, event handlers are still triggered but no changes are comitted to the audit log table. This can be used e.g. if you need to bootstrap many objects and want to programmatically disable auditing to not slow down the bootstrap process or if you want to audit log by Enviroment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.plugin.auditLog.disabled = <span class="predefined-constant">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This setting is "false" by default (auditing is enabled).</p>
</div>
</div>
<div class="sect2">
<h3 id="log-full-class-name"><a class="anchor" href="#log-full-class-name"></a>7.6. Log Full Class Name</h3>
<div class="paragraph">
<p>By default, only the entity class name is logged. If you want to log the entity full name (including the package name), you can enable full logging. Thanks to tcrossland for this feature.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.plugin.auditLog.logFullClassName = <span class="predefined-constant">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This setting is "true" by default (full name is logged).</p>
</div>
</div>
<div class="sect2">
<h3 id="ignoring-specific-events"><a class="anchor" href="#ignoring-specific-events"></a>7.7. Ignoring Specific Events</h3>
<div class="paragraph">
<p>To ignore certain events on a per-domain base, override the <code>getLogIgnoreEvents()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Override</span>
<span class="predefined-type">Collection</span>&lt;AuditEventType&gt; getLogIgnoreEvents() {
    [AuditEventType.INSERT]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also ignore them either globally with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.plugin.auditLog.ignoreEvents = [AuditEventType.INSERT]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or for a specific logging context by using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">AuditLogContext.withConfig(ignoreEvents = [AuditEventType.INSERT]) {
    <span class="comment">//</span>
    <span class="comment">// Anything here will only log UPDATE and DELETE events</span>
    <span class="comment">//</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="runtime-overrides"><a class="anchor" href="#runtime-overrides"></a>7.8. Runtime Overrides</h3>
<div class="paragraph">
<p>See the <a href="#context-overrides">Context Overrides</a> for help using <code>AuditLogContext</code> to override configuration for a block.</p>
</div>
</div>
<div class="sect2">
<h3 id="example-configuration"><a class="anchor" href="#example-configuration"></a>7.9. Example Configuration</h3>
<div class="paragraph">
<p>Example <code>application.groovy</code> configuration with various settings as described above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// AuditLog Plugin config</span>
grails {
    plugin {
        auditLog {
            auditDomainClassName = <span class="string"><span class="delimiter">'</span><span class="content">my.example.project.MyAuditTrail</span><span class="delimiter">'</span></span>
            verbose = <span class="predefined-constant">false</span>
            verboseEvents = [AuditEventType.UPDATE, AuditEventType.INSERT]
            failOnError = <span class="predefined-constant">true</span>
            excluded = [<span class="string"><span class="delimiter">'</span><span class="content">version</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lastUpdated</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lastUpdatedBy</span><span class="delimiter">'</span></span>]
            mask = [<span class="string"><span class="delimiter">'</span><span class="content">password</span><span class="delimiter">'</span></span>]
            logIds = <span class="predefined-constant">true</span>
            stampEnabled = <span class="predefined-constant">true</span>
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usage"><a class="anchor" href="#usage"></a>8. Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use the grails-audit-logging plugin in several ways.</p>
</div>
<div class="sect2">
<h3 id="basic"><a class="anchor" href="#basic"></a>8.1. Basic</h3>
<div class="paragraph">
<p>To enable auditing using the default configuration, simply implement the <code>Auditable</code> trait.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> <span class="directive">implements</span> Auditable {
    <span class="predefined-type">String</span> name
    <span class="predefined-type">Integer</span> age

    <span class="directive">static</span> hasMany = [<span class="key">books</span>: <span class="predefined-type">Book</span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will enable auditing for the domain using your configuration in <code>grails.plugin.auditLog</code> merged with the defaults from <code>DefaultAuditLogConfig.groovy</code> (in the plugin jar).</p>
</div>
</div>
<div class="sect2">
<h3 id="context-overrides"><a class="anchor" href="#context-overrides"></a>8.2. Context Overrides</h3>
<div class="paragraph">
<p>There are many scenarios where you want to use a default configuration for most operations, but need to explicitly override for certain scenarios.</p>
</div>
<div class="paragraph">
<p>One fairly common example is the need to disable audit logging completely for a particular set of changes. This is often the case for bulk operations or operations that might be performed "by the system" such as cleanup, purge, expiration jobs, etc.</p>
</div>
<div class="sect3">
<h4 id="audit-log-context"><a class="anchor" href="#audit-log-context"></a>8.2.1. Audit Log Context</h4>
<div class="paragraph">
<p>You can use the <code>AuditLogContext</code> object to override almost any configuration parameter for a given block</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Enable verbose logging with full class name excluding only properties named 'ssn'</span>
AuditLogContext.withConfig(<span class="key">verbose</span>: <span class="predefined-constant">true</span>, <span class="key">logFullClassName</span>: <span class="predefined-constant">true</span>, <span class="key">excluded</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ssn</span><span class="delimiter">'</span></span>]) { ... }

<span class="comment">// Disable verbose logging</span>
AuditLogContext.withConfig(<span class="key">verbose</span>: <span class="predefined-constant">false</span>) { ... }

<span class="comment">// Disable all logging</span>
AuditLogContext.withConfig(<span class="key">disabled</span>: <span class="predefined-constant">true</span>) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last two are so common, there&#8217;s a method that does them by name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Disable verbose logging</span>
AuditLogContext.withoutVerboseAuditLog { ... }

<span class="comment">// Disable all logging</span>
AuditLogContext.withoutAuditLog { ... }</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The AuditLogContext stores the context using ThreadLocal, so configuration is only present for the current thread. If you start something asynchronously, be sure you setup the context within the new execution thread.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="domain-overrides"><a class="anchor" href="#domain-overrides"></a>8.3. Domain Overrides</h3>
<div class="paragraph">
<p>The context gives you programmatic control over configuration of auditing but you can go even finer grained, if needed, to control auditing on a per-entity basis.</p>
</div>
<div class="paragraph">
<p>To override auditing for a specific entity or based on runtime values, just override the trait method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Assuming this domain has a status attribute, disable auditing for anything not active, for example</span>
<span class="annotation">@Override</span>
<span class="type">boolean</span> isAuditable() {
    <span class="local-variable">this</span>.status == ACTIVE
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another example is to override which properties get ignored for a specific entity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Override</span>
<span class="predefined-type">Collection</span>&lt;<span class="predefined-type">String</span>&gt; getLogExcluded() {
    [<span class="string"><span class="delimiter">'</span><span class="content">myField</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">version</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Control the specific whitelist of attributes logged:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Override</span>
<span class="predefined-type">Collection</span>&lt;<span class="predefined-type">String</span>&gt; getLogIncluded() {
    [<span class="string"><span class="delimiter">'</span><span class="content">whiteListField1</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">whiteListField2</span><span class="delimiter">'</span></span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Customize the id that is logged for the entity, for example instead of using Author&#8217;s <code>id</code> property, log the Author&#8217;s name and age as <code>Tolkien:85</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Override</span>
<span class="predefined-type">String</span> getLogEntityId() {
    <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>name<span class="inline-delimiter">}</span></span><span class="content">:</span><span class="inline"><span class="inline-delimiter">${</span>age<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ability to override and augment the default behavior provided by the trait is what makes the trait implementation so flexible.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Most of the <code>Auditable</code> methods rely on the AuditLogContext for defaults. If you override the trait method, ensure you consider the keeping the default behavior if you are supplementing.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="customized-auditable-trait"><a class="anchor" href="#customized-auditable-trait"></a>8.4. Customized Auditable Trait</h3>
<div class="paragraph">
<p>You could also extend the trait entirely to override the default auditing behavior:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">trait MyAuditable&lt;D&gt; <span class="directive">extends</span> Auditable&lt;D&gt; {
    <span class="comment">// Customize formatting behavior for new and old values</span>
    <span class="annotation">@Override</span>
    <span class="predefined-type">String</span> convertLoggedPropertyToString(<span class="predefined-type">String</span> propertyName, <span class="predefined-type">Object</span> value) {
        <span class="keyword">if</span> (value <span class="keyword">instanceof</span> MySpecialThing) {
            <span class="keyword">return</span> ((MySpecialThing)value).formatAsString()
        }
        <span class="local-variable">super</span>.convertLoggedPropertyToString(propertyName, value)
    }

    <span class="comment">// Customize to populate custom attributes on the audit log entity</span>
    <span class="annotation">@Override</span>
    <span class="type">boolean</span> beforeSaveLog(<span class="predefined-type">Object</span> auditEntity) {
        auditEntity.naturalKey = getNaturalKey()
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="request-resolvers"><a class="anchor" href="#request-resolvers"></a>8.5. Request Resolvers</h3>
<div class="paragraph">
<p>Audit logging usually requires auditing the user and/or request context for a specific action. The plugin supports a pluggable method of resolving request context by registering an <code>auditRequestResolver</code> bean that applications can override if needed.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Spring-Security-Core plugin between version 3.2.1 and 4.0.1 has been set to MODE_INHERITABLETHREADLOCAL. This can lead to current actor problems, as it might keep the former security context. This setting was changed back to the secure MODE_THREADLOCAL in Spring-Security-Core 4.0.1. If you use a Spring-Security-Core plugin and see weird actor behavior, either upgrade the Spring-Security-Core plugin, or explicitly set the SecurityContextHolder strategy to MODE_THREADLOCAL.
<a href="https://github.com/grails/grails-spring-security-core/issues/587" class="bare">https://github.com/grails/grails-spring-security-core/issues/587</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="audit-request-resolvers"><a class="anchor" href="#audit-request-resolvers"></a>8.5.1. Audit Request Resolvers</h4>
<div class="paragraph">
<p>The plugin ships with two resolvers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">DefaultAuditRequestResolver</span> <span class="directive">implements</span> AuditRequestResolver { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">SpringSecurityRequestResolver</span> <span class="directive">extends</span> DefaultAuditRequestResolver { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default resolver uses the <code>principal</code> in the active GrailsWebRequest to resolve the Actor name and Request URI for logging purposes.</p>
</div>
<div class="paragraph">
<p>If a bean named <code>springSecurityService</code> is available, the second resolver is registered which uses the <code>currentUser()</code> method to resolve the user context.</p>
</div>
<div class="paragraph">
<p>For other authentication strategies, you can implement and override the <code>auditRequestResolver</code> bean with your own implementation of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">interface</span> AuditRequestResolver {
    <span class="comment">/**
     * @return the current actor
     */</span>
    <span class="predefined-type">String</span> getCurrentActor()

    <span class="comment">/**
     * @return the current request URI or null if no active request
     */</span>
    <span class="predefined-type">String</span> getCurrentURI()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just register your resolver in <code>resources.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beans = {
    auditRequestResolver(CustomAuditRequestResolver) {
        customService = ref(<span class="string"><span class="delimiter">'</span><span class="content">customService</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Below are a few examples for other common security frameworks.</p>
</div>
<div class="sect4">
<h5 id="acegi-plugin"><a class="anchor" href="#acegi-plugin"></a>Acegi Plugin</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">/**
 * @author Jorge Aguilera
 */</span>
<span class="type">class</span> <span class="class">AcegiAuditResolver</span> <span class="directive">extends</span> DefaultAuditRequestResolver {
    <span class="keyword">def</span> authenticateService

    <span class="annotation">@Override</span>
    <span class="predefined-type">String</span> getCurrentActor() {
        authenticateService?.principal()?.username ?: <span class="local-variable">super</span>.getCurrentActor()
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cas-authentication"><a class="anchor" href="#cas-authentication"></a>CAS Authentication</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">edu.yale.its.tp.cas.client.filter.CASFilter</span>

<span class="type">class</span> <span class="class">CASAuditResolver</span> <span class="directive">extends</span> DefaultAuditRequestResolver {
    <span class="keyword">def</span> authenticateService

    <span class="annotation">@Override</span>
    <span class="predefined-type">String</span> getCurrentActor() {
        GrailsWebRequest request = GrailsWebRequest.lookup()
        request?.session?.getAttribute(CASFilter.CAS_FILTER_USER)
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="shiro-plugin"><a class="anchor" href="#shiro-plugin"></a>Shiro Plugin</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Component</span>(<span class="string"><span class="delimiter">'</span><span class="content">auditRequestResolver</span><span class="delimiter">'</span></span>)
<span class="type">class</span> <span class="class">ShiroAuditResolver</span> <span class="directive">extends</span> DefaultAuditRequestResolver {
    <span class="annotation">@Override</span>
    <span class="predefined-type">String</span> getCurrentActor() {
        org.apache.shiro.SecurityUtils.getSubject()?.getPrincipal()
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stamping"><a class="anchor" href="#stamping"></a>9. Stamping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Stamping adds the following attributes to a domain object via the <code>Stampable</code> trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">trait Stampable&lt;D&gt; <span class="directive">extends</span> GormEntity&lt;D&gt; {
    <span class="predefined-type">Date</span> dateCreated
    <span class="predefined-type">Date</span> lastUpdated

    <span class="predefined-type">String</span> createdBy
    <span class="predefined-type">String</span> lastUpdatedBy
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The attributes will assume the default constraints, which should be fine for most cases.</p>
</div>
<div class="paragraph">
<p>You can configure the <code>constraints</code> and <code>mappings</code> block as usual in your domain class to customize the stampable properties.</p>
</div>
<div class="sect2">
<h3 id="stamping-configuration"><a class="anchor" href="#stamping-configuration"></a>9.1. Stamping Configuration</h3>
<div class="paragraph">
<p>Previous versions used an AST transformation to apply the stamping and could allow more configuration.
For now, the stamping support has been boiled down to just the basic trait attributes and the ability to disable the plugin globally.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Enable or disable stamping</span>
grails.plugin.auditLog.stampEnabled = <span class="predefined-constant">true</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you disable stamping but have <code>Stampable</code> entities, they will likely fail validation since the plugin will not be populating the fields which are still added to the domain objects. The main reason to disable stamping is to prevent the listener registration in the case that you just aren&#8217;t using the <code>Stampable</code> support.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to mark <strong>all</strong> of your domain objects as stampable, you could define the following <code>TraitInjector</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">StampableTraitInjector</span> <span class="directive">implements</span> TraitInjector {
    <span class="annotation">@Override</span>
    <span class="predefined-type">Class</span> getTrait() {
        Stampable
    }

    <span class="annotation">@Override</span>
    <span class="predefined-type">String</span><span class="type">[]</span> getArtefactTypes() {
        [<span class="string"><span class="delimiter">'</span><span class="content">Domain</span><span class="delimiter">'</span></span>] <span class="keyword">as</span> <span class="predefined-type">String</span><span class="type">[]</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementation"><a class="anchor" href="#implementation"></a>10. Implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most of the plugin code is marked as @CompileStatic.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="auditing-and-transactions"><a class="anchor" href="#auditing-and-transactions"></a>11. Auditing and Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All audit events for the current transaction are queued up.
They are flushed after the transaction has successfully been committed.
This allows the AuditLogListener to use its own session and transaction.</p>
</div>
<div class="sect2">
<h3 id="auditlogeventlistener"><a class="anchor" href="#auditlogeventlistener"></a>11.1. AuditLogEventListener</h3>
<div class="paragraph">
<p>The Audit Logging plugin registers a PersistenceEventListener (<code>AuditLogListener</code>) bean per datasource, which listens to GORM events.</p>
</div>
</div>
<div class="sect2">
<h3 id="stampeventlistener"><a class="anchor" href="#stampeventlistener"></a>11.2. StampEventListener</h3>
<div class="paragraph">
<p>The plugin registers a separate StampEventListener that responds to validate events. Ideally, we would stamp when an insert or update event occurs, but since the attributes are non-null by default, we need to populate them before the default validation is triggered.</p>
</div>
</div>
<div class="sect2">
<h3 id="plugin-descriptor"><a class="anchor" href="#plugin-descriptor"></a>11.3. Plugin Descriptor</h3>
<div class="paragraph">
<p>The Plugin Descriptor (AuditLogListenerGrailsPlugin) configures the plugin during startup.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configures the plugin either by default values - see DefaultAuditLogConfig.groovy - or by user configured settings.</p>
</li>
<li>
<p>Registers a PersistenceEventListener bean per datasource</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="auditable-trait"><a class="anchor" href="#auditable-trait"></a>11.4. Auditable trait</h3>
<div class="paragraph">
<p>Enabling auditing on a Domain class is done by implementing the <code>Auditable</code> trait.</p>
</div>
</div>
<div class="sect2">
<h3 id="stampable-trait-2"><a class="anchor" href="#stampable-trait-2"></a>11.5. Stampable trait</h3>
<div class="paragraph">
<p>Enabling stamping on a Domain class is done by implementing the <code>Stampable</code> trait.
This trait adds the properties dateCreated, lastUpdated, createdBy and lastUpdatedBy
to the domain class.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 6.0.0-SNAPSHOT<br>
Last updated 2024-12-09 13:45:51 UTC
</div>
</div>
</body>
</html>